<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10秒ジャブ連打チャレンジ</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 30% 30%, #101220, #05060e 60%);
      --panel: rgba(255, 255, 255, 0.06);
      --text: #e8f6ff;
      --accent: #4ef0c0;
      --accent-2: #ff6b9a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .app {
      width: min(920px, 100%);
      background: var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.35);
      overflow: hidden;
      backdrop-filter: blur(6px);
    }
    header {
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      background: linear-gradient(135deg, rgba(78, 240, 192, 0.18), rgba(255, 107, 154, 0.2));
    }
    header h1 {
      margin: 0;
      font-size: 24px;
      letter-spacing: 0.04em;
    }
    header p {
      margin: 4px 0 0;
      color: #cdd9e5;
      font-size: 14px;
    }
    .content {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 16px;
      padding: 20px 24px 24px;
    }
    .board {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .score {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      text-align: center;
    }
    .score div {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }
    .score .value {
      font-size: 34px;
      margin-top: 6px;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
    }
    .status {
      font-size: 15px;
      color: #c9d6e3;
    }
    .timer {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      color: #cde6ff;
    }
    .bar {
      flex: 1;
      height: 10px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .bar-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 0.1s ease-out;
    }
    .hands {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    .hand-card {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    .hand-card h3 {
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
    }
    .hand-card .count {
      font-size: 28px;
      margin: 6px 0 0;
      font-variant-numeric: tabular-nums;
    }
    .hand-card kbd {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.25);
      font-weight: 600;
      color: #e8f6ff;
      min-width: 28px;
      text-align: center;
    }
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    button {
      appearance: none;
      border: none;
      border-radius: 12px;
      padding: 12px 18px;
      background: linear-gradient(135deg, #4ef0c0, #34b3ff);
      color: #04131d;
      font-weight: 700;
      font-size: 15px;
      letter-spacing: 0.03em;
      cursor: pointer;
      box-shadow: 0 8px 16px rgba(52, 179, 255, 0.25);
      transition: transform 0.08s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }
    button.secondary {
      background: rgba(255, 255, 255, 0.08);
      color: #dfe9f5;
      box-shadow: none;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    button:active {
      transform: translateY(1px);
      filter: brightness(0.95);
    }
    .keys {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, 1fr));
      gap: 12px;
    }
    .key-card {
      border: 1px dashed rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 10px 12px;
    }
    .key-card strong { color: var(--accent); }
    .log {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 12px;
      min-height: 80px;
      font-size: 14px;
      color: #cfd9e6;
    }
    .pulse {
      animation: pulse 0.18s ease;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    @media (max-width: 760px) {
      .content { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <div>
        <h1>10秒ジャブ連打チャレンジ</h1>
        <p>左手と右手のキーを交互に叩いて、10秒間で何発ジャブを打てるか計測しよう！</p>
      </div>
    </header>
    <div class="content">
      <section class="board" aria-live="polite">
        <div class="score">
          <div>
            <div class="label">合計ジャブ</div>
            <div id="total" class="value">0</div>
          </div>
          <div>
            <div class="label">残り時間</div>
            <div id="time" class="value">10.00s</div>
          </div>
          <div>
            <div class="label">ベスト</div>
            <div id="best" class="value">0</div>
          </div>
        </div>
        <div class="timer">
          <span>進行状況</span>
          <div class="bar" aria-hidden="true">
            <div class="bar-fill" id="bar"></div>
          </div>
        </div>
        <div class="hands">
          <div class="hand-card" id="left-card">
            <h3>左ジャブ <kbd>A</kbd> / <kbd>←</kbd></h3>
            <div class="count" id="left-count">0</div>
          </div>
          <div class="hand-card" id="right-card">
            <h3>右ジャブ <kbd>L</kbd> / <kbd>→</kbd></h3>
            <div class="count" id="right-count">0</div>
          </div>
        </div>
        <div class="controls">
          <button id="start-btn" aria-label="ゲーム開始">10秒スタート</button>
          <button id="reset-btn" class="secondary" aria-label="リセット">リセット</button>
        </div>
        <div class="status">スペースキーでも開始できます。キーを押した瞬間にカウントされます（長押しは1回扱い）。</div>
        <div class="log" id="log">準備完了。STARTボタンかスペースキーで計測開始！</div>
      </section>
      <aside class="board">
        <h3>遊び方</h3>
        <div class="keys">
          <div class="key-card">左手：<strong>A</strong> または <strong>←</strong></div>
          <div class="key-card">右手：<strong>L</strong> または <strong>→</strong></div>
          <div class="key-card">開始：<strong>スペース</strong> または <strong>ボタン</strong></div>
          <div class="key-card">停止：<strong>リセット</strong> ボタン</div>
        </div>
        <p style="margin:12px 0 0; color:#c9d6e3; font-size:14px;">できるだけ両手を交互に動かし、リズムを崩さずに連打すると高記録が狙えます。身体を痛めないように、ウォームアップしてから挑戦してください！</p>
      </aside>
    </div>
  </main>
  <script>
    const totalEl = document.getElementById('total');
    const timeEl = document.getElementById('time');
    const bestEl = document.getElementById('best');
    const barFill = document.getElementById('bar');
    const leftCountEl = document.getElementById('left-count');
    const rightCountEl = document.getElementById('right-count');
    const logEl = document.getElementById('log');
    const leftCard = document.getElementById('left-card');
    const rightCard = document.getElementById('right-card');
    const startBtn = document.getElementById('start-btn');
    const resetBtn = document.getElementById('reset-btn');

    const DURATION = 10_000; // 10 seconds
    let timerId = null;
    let startTime = null;
    let left = 0;
    let right = 0;
    let best = Number(localStorage.getItem('jab-best') || 0);
    let running = false;

    bestEl.textContent = best;

    const handKeys = {
      left: ['a', 'ArrowLeft'],
      right: ['l', 'ArrowRight'],
    };

    function updateCounts() {
      const total = left + right;
      totalEl.textContent = total;
      leftCountEl.textContent = left;
      rightCountEl.textContent = right;
      if (total > best) {
        best = total;
        bestEl.textContent = best;
        localStorage.setItem('jab-best', best);
        log(`記録更新！ ${best} ジャブ`);
      }
    }

    function setTime(ms) {
      const seconds = Math.max(0, ms / 1000);
      timeEl.textContent = `${seconds.toFixed(2)}s`;
      const progress = Math.min(1, (DURATION - ms) / DURATION);
      barFill.style.width = `${progress * 100}%`;
    }

    function log(message) {
      logEl.textContent = message;
    }

    function pulse(el) {
      el.classList.remove('pulse');
      void el.offsetWidth;
      el.classList.add('pulse');
    }

    function startGame() {
      if (running) return;
      running = true;
      left = 0;
      right = 0;
      updateCounts();
      startTime = performance.now();
      setTime(DURATION);
      log('計測中！リズムよくジャブを打とう！');
      timerId = requestAnimationFrame(tick);
    }

    function endGame() {
      if (!running) return;
      running = false;
      if (timerId) cancelAnimationFrame(timerId);
      timerId = null;
      setTime(0);
      log(`結果: 合計 ${left + right} ジャブ。もう一度挑戦しよう！`);
    }

    function resetGame() {
      if (timerId) cancelAnimationFrame(timerId);
      running = false;
      left = 0;
      right = 0;
      startTime = null;
      setTime(DURATION);
      updateCounts();
      log('準備完了。STARTボタンかスペースキーで計測開始！');
    }

    function tick(now) {
      const elapsed = now - startTime;
      const remaining = Math.max(0, DURATION - elapsed);
      setTime(remaining);
      if (remaining <= 0) {
        endGame();
        return;
      }
      timerId = requestAnimationFrame(tick);
    }

    function handlePunch(key) {
      if (!running) return;
      if (handKeys.left.includes(key)) {
        left += 1;
        updateCounts();
        pulse(leftCard);
      } else if (handKeys.right.includes(key)) {
        right += 1;
        updateCounts();
        pulse(rightCard);
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.repeat) return;
      if (e.code === 'Space') {
        e.preventDefault();
        if (!running) startGame();
        return;
      }
      handlePunch(e.key);
    });

    startBtn.addEventListener('click', startGame);
    resetBtn.addEventListener('click', resetGame);

    setTime(DURATION);
  </script>
</body>
</html>
